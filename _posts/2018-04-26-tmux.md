---
layout: post
title:  "tmux"
date:   2018-04-26 10:36:30 +0800
categories: [tmux]
tags: [tmux]
---

# tmux
## 初始tmux
* tmux →    terminal multiplexer ['mʌltɪ,plɛksɚ] 多路器
    *  换句话说，它可以将您的单终端会话分成多个会话
* Tmux采用C/S模型构建，输入Tmux命令就相当于开启了一个服务器，此时默认将新建一个会话，然后会话中默认新建一个窗口，窗口中默认新建一个面板。

* tmux中有3种概念，
    * 会话(session)
    * 窗口(window)
    * 窗格(pane [peɪn])

    * 会话有点像是tmux的服务，在后端运行，我们可以通过tmux命令创建这种服务，并且可以通过tmux命令查看，附加到后端运行的会话中。

    * 一个会话可以包含多个窗口，一个窗口可以被分割成多个窗格(pane)。

    * 一个tmux的会话中可以有多个窗口(window)，每个窗口又可以分割成多个pane(窗格)。我们工作的最小单位其实是窗格。默认情况下在一个window中，只有一个大窗格，占满整个窗口区域。我们在这个区域工作。

## 安装
* sudo apt-get install tmux

* -t: target-session
* -s参数表示session名称，如果不加-s参数，那么Tmux默认会新建一个以数字(下标从0开始)命名的session

## 使用
* ctrl b
    * 激活控制台；此时以下按键生效
* 状态栏
    * 0:会话名
    * 0:当前会话的窗口序号
    * myserver :0号窗口的名字
* ?
    * 列出所有快捷键；按q返回
    
### 会话
#### 增
* tmux new-session -s [SESSION-NAME]
* tmux new -s [SESSION-NAME]        //可以为字母或数字
* tmux new                          //也可不指定会话名称
    * 此时 tmux 的名称为数字从0开始排列

#### 删
* 关闭会话 (在会话内部或外部执行均可)
    * tmux  kill-session  -t  [SESSION-NAME]

* 关闭服务器，所有的会话都将关闭
    * tmux kill-server

* 断开当前会话，会话在后台运行
    * tmux detach
    * 前缀 d

#### 改
* 重新附加到会话中
    * tmux attach-session -t [session-name]
    * tmux attach  -t  [SESSION-NAME]
    * tmux a  -t [SESSION-NAME]  
    * tmux a                                //如果只有一个会话, 如果不指定会话名，将会链接上次使用的会话
* 重命名会话
    * tmux rename -t old_session_name  new_session_name
    * 前缀 $ 新会话

#### 查
* 查看已创建的会话
    * tmux ls       
    * tmux list-session

* 以菜单方式显示 当前linux机器上 tmux 所有的后台会话列表
    * 前缀 s

* 选择要脱离的会话；在同时开启了多个会话时使用
    * 前缀 D

* 进入命令行模式；此时可以输入支持的命令，例如 kill-server 可以关闭服务器
    * 前缀 :


    * 强制重绘未脱离的会话
        * 前缀 r
    * 列出提示信息缓存；其中包含了之前tmux返回的各种提示信息
        * 前缀 ~

### 窗口
* 一个会话的所有窗口都会在 状态栏 从左到右 按照数字编号依次排序

#### 增
* 创建新窗口
    * 前缀 c

#### 删
* 关闭当前窗口
    * 前缀 &

#### 改
* 切换至指定窗口
    * 前缀 数字

* 切换至上一窗口
    * 前缀 p

* 切换至下一窗口
    * 前缀 n

* 在前后两个窗口间互相切换
    * 前缀 l

* 通过窗口列表切换窗口
    * 前缀 w

* 重命名当前窗口；这样便于识别
    * 前缀 ,

* 修改当前窗口编号；相当于窗口重新排序
    * 前缀 .

#### 查
* 在所有窗口中查找指定文本
    * 前缀 f

### 面板(pane)
#### 增
* 分割为上下两个
    * 前缀 "

* 分割为左右两个
    * 前缀 %
    * 当前窗格周围高亮显示边框

#### 删
* 关闭当前面板
    * logout 或者 exit  或者 ctrl+d
    * 一旦你关闭了窗口中的所有窗格，那么该窗口也会消失。
    * 前缀 x    (操作之后会给出是否关闭的提示，按y确认即关闭)


#### 改
* 在当前窗口中选择下一面板
    * 前缀 o

* 数字会短暂的出现在窗格上。在这期间，你可以你想要浏览的窗格上对应的数字
    * 前缀 q

* 移动光标以选择面板
    * 前缀 方向键
* 修改了配置文件
    * 前缀 hjkl

* 调整当前面板大小
    * ctrl b ctrl 方向键
* 修改了配置文件
    * 前缀 Ctrl不松手 hjkl

* 活动窗格最大化
    * 前缀 z

#### 查
* 将当前面板移动到新窗口；即新建一个窗口
    * 前缀 !

* 向前置换当前面板
    * 前缀 {

* 向后置换当前面板
    * 前缀 }

* 显示时钟。然后按enter键后就会恢复到shell终端状态
    * 前缀 t

## 复制模式
1. 前缀 [       //进入复制模式
1. 按 space     //开始复制，hjkl
1. enter        //复制，并退出 copy-mode
1. 前缀 ]       //粘贴

## 配置
* .tmux.conf
    * 设置为 vi 快捷键
        * set -g mode-keys vi
    * 更换前缀
        * set -g prefix C-a #
        * unbind C-b # C-b即Ctrl+b键，unbind意味着解除绑定
        * bind C-a send-prefix # 绑定Ctrl+a为新的指令前缀

    * 使 .tmux.conf 生效的两种方式
        * 重启 tmux
        * 在 Tmux 窗口中，按下前缀，→ : → source-file ~/.tmux.conf  →   回车

    * 有的地方可能会出现set-window-option的写法，setw就是它的别名。
    * 开启鼠标支持
        * set-option -g mouse on
        * 右键按 2 次 才会出来

    * 绑定 hjkl 
        * -r表示可重复按键，大概500ms之内
        * bind -r k select-pane -U # 绑定k为↑
        * bind -r j select-pane -D # 绑定j为↓
        * bind -r h select-pane -L # 绑定h为←
        * bind -r l select-pane -R # 绑定l为→

## 保存 tmux 会话
* Tmux保护现场的能力依赖于Tmux进程，如果进程退出，则意味着会话数据的丢失，因此关机重启后，Tmux中的会话将被清空，这不是我们想要见到的。幸运的是，目前有这样两款插件：Tmux Resurrect [ˌrɛzəˈrɛkt](复兴) 和 Tmux Continuum，可以永久保存Tmux会话（它们均适用于Tmux v1.9及以上版本）。

### <a href='https://github.com/tmux-plugins/tmux-resurrect'>tmux resurrect</a>
要保存 Tmux 会话，我们只要按 前缀键 + Ctrl-s 就可以了。此时，Tmux 状态栏会显示“Saving ...”字样，完毕后会提示 Tmux 环境已保存。

Tmux Resurrect 会将 Tmux 会话的详细信息以文本文件形式保存到 ~/.tmux/resurrect 目录。

还原则进入一个tmux 按 前缀键 + Ctrl-r 即可。

## <a href='https://github.com/tmux-plugins/tpm'>tmux tpm使用方法</a>
### Installing plugins

Add new plugin to ~/.tmux.conf with set -g @plugin '...'

Press prefix + I (capital I, as in Install) to fetch the plugin.

You're good to go! The plugin was cloned to ~/.tmux/plugins/ dir and sourced.

### Uninstalling plugins

Remove (or comment out) plugin from the list.

Press prefix + alt + u (lowercase u as in uninstall) to remove the plugin.

All the plugins are installed to ~/.tmux/plugins/ so alternatively you can find plugin directory there and remove it.

### Key bindings
prefix + I

Installs new plugins from GitHub or any other git repository    
Refreshes TMUX environment    
prefix + U    

updates plugin(s)
prefix + alt + u

remove/uninstall plugins not on the plugin list

## probmems
* 在一个 tmux 会话中 tmux new -s 会话名
    * sessions should be nested with care, unset $TMUX to force

<a href='http://man.openbsd.org/OpenBSD-current/man1/tmux.1'>tmux 官方手册</a>

<a href='http://louiszhai.github.io/2017/09/30/tmux/'>tmux 使用手册</a>

<a href='https://linuxtoy.org/archives/tmux-resurrect-and-continuum.html'>Tmux Resurrect使用方法</a>

<a href='https://github.com/tmux-plugins/'>tmux plugins in Github</a>
