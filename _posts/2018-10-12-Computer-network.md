---
layout: post
title: 计算机网络
---

## 二进制
### 二进制取余法原理
权位

十进制数，有：万、千、百、十、个，各个位。
那么从一个数字中，比如 80486，
分离出来个位，应该先除以10，取出余数就是6；
还要再分离出来十位数，应该再除以10，取出余数8；
……
二进制数，各个位是：8、4、2、个。
求其中每个位的数字，那就是“除二取余”

**借一当二**
**借一当八**
**借一当十**
**借一当十六**

binary
octonary 英['ɒktənərɪ]
decimal
hexadecimal 英[ˌheksəˈdesɪml]

15=2^4-1    四位二进制，最右侧是2^0,    故是 1111
    应该还是按照原来的想法来解释，所有位的和=(2^(n+1))-1 

### 乘法、除法
同10进制乘法

## Internet
美国军方ARPA net ☞  TCP/IP ☞  Internet

ARPA:高级研究计划局  1958年组件
1966年 提出ARPA计划
DoD:United States Department of Defense
NCP网络协议
1983年 ARPAnet 由NCP 向 TCP/IP 转移;同年 分成 NSFNET(科研) 和 MILNET(军事)
1990年 NSFNET彻底代替了ARPAnet 成为 Internet的主干

## 互联网接入方法
1. 电话拨号接入(PSTN 公共交换电话网)
    1. modem:分为调制器 和 解调器
        1. RS232接口（类似VGA)
        1. RJ11
    1. 56kbps
    1. 电脑 电话 选其中一个同时

1. ISDN接入（电话线）综合业务数字网，也叫一线通, 
    1. 电话 和 电脑 可以同时
    1. 传输的是数字信号
    1. 128Kbps(窄带)

1. ADSL:非对称数字用户环路（电话线）
    * 非对称：上行最高1Mbps,下行最高8Mbps
    * ADSL2+: 下行最高24Mbps
    * 铜线
    * 3-5 km
    * 下行通道用于下载，中速双工通道用于上传
    * 可同时打电话上网
    * 上网不需要缴付电话费
    
    * 语音分离器(需要供电) 早期
        1. 出口
        1. modem口 接modem
        1. phone口
    * 路由器WAN口和LAN口各有一个MAC地址，WAN口MAC地址是对外通信的，LAN口地址是对内通信的。
        1. wds 无线分布式系统，路由器级联
        1. 秘钥更新周期就是路由隔段时间重新进行一次运算，产生新的哈希值，防止别人破译。本来根据哈希值回算密码就很难的，再加上定时地更新，就会更加安全。
        1. Beacon([ˈbi:kən]烽火，灯塔)时槽：信标间隔时槽,通俗的理解就是无线路由器要不停告知自己的存在（这样无线网卡才可以扫描到），向空口持续发送一个叫做beacon的报文，beacon时槽就是控制这个报文发送的速率。一般无线网卡都是做所谓的被动式扫描(passive scanning)
        1. 转发规则
            * 虚拟服务器，将公网上访问本地的数据，转发至指定本地ip、服务器
            * DMZ主机，
                * “demilitarized zone”的缩写，中文名称为“隔离区”，也称“非军事化区”。它是为了解决安装防火墙后外部网络不能访问内部网络服务器的问题，而设立的一个非安全系统与安全系统之间的缓冲区，这个缓冲区位于企业内部网络和外部网络之间的小网络区域内，在这个小网络区域内可以放置一些必须公开的服务器设施，如企业Web服务器、FTP服务器和论坛等。另一方面，通过这样一个DMZ区域，更加有效地保护了内部网络，因为这种网络部署，比起一般的防火墙方案，对攻击者来说又多了一道关卡。
                * 设置了虚拟服务器，此时虚拟服务器就在DMZ中
        1. 地址租期：这个ip的可使用时间

    * PPPoE是一种2层链路技术,Point to Point Protocol over Ethernet,以太网上的点对点协议
1. Cable MODEM接入
    * 线缆调制解调器
        * 有那种同轴电缆口 和 RJ45口
    * 是一种通过**有线电视网**来上网的技术
    * 非对称式数据传输
        * 上行：2Mbps - 10Mbps
        * 下行：10Mbps - 36Mbps

1. FTTH 光钎
    * 光纤交换机，光纤路由器 贵
1. 小区宽带
    * 一个大局域网，所有客户都在同一个网段中。
    * 共享带宽。



1. 局域网接入
1. 用户单机接入


信道：信息的通道
    全双工信道
        频分双工(FDD)
        时分双工（TDD)
    单工信道
    半双工信道
基带信号
    就是数字信号，高低电平
频带信号
    就是模拟信号

多路复用
    在一条传输介质上传输多个信号,提高信道利用率
    
    频分多路复用（FDM)
        * 模拟信号
        * 多路复用编码器
        * 多路复用解码器
    时分多路复用（TDM)
        * 数字信号
        * 时间分片

同步传输
    要双方进行合作
    发送者只有得到接收者送来的允许发送的信号后才能发送数据
    接收者也必须收到发送者所指示的数据发送完毕、允许接收的信号后才能接收
    以块为单位,帧

异步传输
    发送者和接受者之间不需要进行合作
    发送者可以在任何时候发送数据
    接收者只要数据到达就接收数据
    起始位-数据-结束位
    以字符为单位（8bit)
    比较浪费，因为起始位，结束位占比很高

1. 数据通信技术指标
    1. 传输数量
        1. 信道容量
        1. 传输速率
            1. 波特率
                * 通信领域
                * 针对于串口通信
                * 9600 bit/s
                * **波形速率**,单位事件传输了多少个波形,单位是“波特”
            1. 比特率
                * 一般用在PC领域
                * 信息传输
    1. 传输质量
        1. 误码率
            1. bit个数占比


## 网络通信协议

### OSI RM(open system interconnect Reference Model) 开放系统互联 参考模型
PDU(protocol data unit) 协议数据单元，每一层加上协议头，协议尾部
    * 对等层之间传递的数据单位

1. 应用层           APDU    
    * 用户和系统的接口
    * 和应用程序不一样的，一个联网的环境
    * 应用程序访问网络的窗口

1. 表示层           PPDU    
    * 数据的表现形式，ASCII，jpg
    * 格式化数据
    * 提供加密

1. 会话层           SPDU    
    * 简历、管理和终止在应用程序之间的会话
    * 是否远程
    * 对回话的双方尽心资格审查和验证的规则，同时规定双工模式
    * 允许不同计算机上的两个应用程序简历、使用和结束会话连接

1. 传输层           Segment  
    * 端连接，具体到端口号端到端的通信信道
    * 不同系统之间的进程间数据交互的服务
    * 承上启下的层
        * 上边的可以说是 资源子网
        * 下边的可以说是 通信子网
    * **确保报文无差错、有序、不丢失、无重复的传输**
    * **分割数据与重组数据、按端口号寻址、连接管理、差错控制和流量控制**
    * 可靠连接(TCP)

    * 不可靠连接(UDP)    
        * User Datagram Protocol
    * **数据分组了**

1. 网络层           报文    Packet
    * 提供逻辑地址IP
    * 路径选择
    * 拥挤控制
    * 路由器

1. 数据链路层       帧      Frame
    * 成帧，用MAC地址访问媒介（48bits)
    * 网卡mac地址
    * 功能：
        1. 数据成帧
        1. 调节发送速率和接收速率的匹配？
    * 二层交换机
    * T标记（tail)
        1. 数据的结束
        1. 差错控制？
            * 传到对方之后保证数据没有丢失啊，之类的，估计是通过算法确定T标记，类似hash之类的

1. 物理层           比特    Bit
    * 物理接口，电气特性
    * 光钎，电缆，双绞线
    * 特性
        1. 机械特性
            * 几个孔，几个针，以及排列之类的
        1. 电器特性
            * 信号状态的电压、电流、最大传输速率
        1. 功能特性
            * 规定了借口信号的来源、作用及信号间的关系
        1. 过程特性
            * 进行数据交换的控制步骤


1. 市场化失败的原因
    1. 没有商业驱动
    1. 实现起来比较复杂
    1. 层次划分并不合理，有些功能在过个层次中重复出现

1. 虚通信，实通信，对等实体
1. 实际的通信只在物理层完成


### TCP/IP(并不适用于非TCP/IP网络，如令牌环网)
目的：异种网的互联问题
传输控制协议/网际协议
是一个协议簇
IP(internet protocol)
ICMP(internet control message protocol)
ARP(address resolution protocol) 
RARP(reverse address resolution protocol)

1. 应用层(3)    AL
    * 各种服务，如 FTP、Telnet

    * 应用层、传输层的接口
        * 端口
            1. FTP 21
            1. Telnet 23
            1. Smtp 25
            1. DNS 53
            1. TFTP 69
            1. ssh 22
        * 一个服务可能会用到多个端口

1. 传输层   TL
    * TCP(在TCP/IP中一般叫做数据报)
        * 三次握手
            * <img src='./assets/sanCiWoShou.png'>
            * 两军问题
        * 面向连接的
    * UDP(User Datagram protocol)(在TCP/IP中一般叫做段)
        * 快

1. 网络层   NL
    * IP
        1. 寻址和路由
        1. 传递服务
            1. 不可靠，可靠性由上层协议提供
            1. 无连接
        1. 数据报分段和重组
        1. 服务类型现在叫 差分服务
    * IGMP 互联网组管理协议
    * ICMP 互联网控制报文协议
    * ARP(地址解析协议) ip 找 MAC地址
    * RARP

1. 网络接口层(2)    NIL
    * IEEE:institute of electracal and electronics engineers 电气电子工程协会
    * IEEE802:
        1. 1980年02月份制定的
        1. 对象是数据链路层 和 物理层 
        1. 把数据链路层分为
            1. LLC:逻辑链路层
                1. 不确认的无连接服务:不需要对方确认要不要接收，不事先通知，（联想 电路交换）
                    * 多播，广播时候
                1. 面向连接的服务:
                1. 需确认的无连接的服务
                    * 报警信号
                1. 高速传送的服务
                
            1. MAC:介质访问控制(media access control)
                1. 循环式
                1. 预约式
                1. 竞争式：先到先得
        802.3:CSMA/CD
        802.4:Token bus 令牌总线    （淘汰）
        802.5:Token ring    令牌环  (淘汰)
        
        llc mac 的概念早就淘汰了


    局域网中使用网络接口层协议的代表
        1. 以太网
        1. 令牌环
        1. FDDI
    广域网中使用网络接口层协议的代表
        1. SLIP(串行链路网际协议)
        1. PPP(点对点协议，MTU 默认1500Bytes)

交换机判断是发往外网的还是局域网的

## 互联网的应用
### www
1. ssl加密
1. https 端口是443

### 邮件
#### 邮件用户代理(MUA,mail user agent)
1. POP3(Post office protocol 3) 110端口
    SSL协议端口号：995
1. IMAP(internet mail access protocol) 143端口
    SSL协议端口号：143
1. exchange
这几种协议用于接收用户的邮件,选择其中之一

IMAP 的所有操作都会同步到Server端
POP3 在本地不会和Server同步，所有操作仅仅影响客户端的

pop3.163.com(接收邮件服务器，服务器接收来自你的邮件)
    最初的pop3:当你在客户端接收了之后，Server里就没有了
    第三方应用程序
imap.163.com

例如：
foxmail
outlook

#### 邮件传输代理(MTA,mail transfer protocol) 报文传送代理
1. SMTP(simple mail transfer protocol) 25端口
    SSL协议端口号：465/994
针对服务器的，如从163 到 sina

smtp.163.com(发送邮件服务器，服务器发送)
MUA,MTA 也可是同一个Server
发送和接收一般一致

#### 邮件投递代理(MDA,mail delivery agent)
最后一个MTA也叫MDA

## FTP(File transfer protocol)
1. 21端口进行请求，应允的控制,进行控制
1. 20端口进行数据传输

## telnet(远程登录) 早期, 目前用SSH
windows上还要将用户添加到 telnetClients 组


## 计算机网络
### 计算机网络的功能
1. 数据通信
1. 资源共享
1. 集中管理
1. 分布式处理
    1. 如视频渲染
1. 负载均衡

### 分类
#### 规模
1. LAN
1. MAN  城域网 metropolitan [ˌmetrəˈpɒlɪtən] 大都会，大城市
1. WAN  广域网
1. Internet


#### 拓扑结构
1. 总线型

1. 环形
    1. 令牌
        在令牌环网中有一个令牌（Token）沿着环形总线在入网节点计算机间依次传递，令牌实际上是一个特殊格式的帧，本身并不包含信息，仅控制信道的使用，确保在同一时刻只有一个节点能够独占信道。当环上节点都空闲时，令牌绕环行进。节点计算机只有取得令牌后才能发送数据帧，因此不会发生碰撞。由于令牌在网环上是按顺序依次传递的，因此对所有入网计算机而言，访问权是公平的。

1. 星型


## 网络设备
网络适配器（NIC）

按照总线分类
1. ISA(16bit)
1. EISA(32bit)
1. PCI(32bit)
    1. PCI  
    1. PCI-E  较短


1. 中继器 repeater 
1. 集线器,特殊的中继器 hub 
1. 网桥(接口少)
1. 交换机
1. 路由器

## IP 包头
* 版本
    * ipv4
    * ipv6
        * 2^128
* 源IP地址
    * 2^32位=43亿
* 目标IP地址
    * 2^32位=43亿

### IP 分类
<img src='./assets/ipFenlei.png'>

多年的疑惑之ip MAC Vlan
计算机在和其他计算机通信之前，首先要判断目标IP地址和自己的IP地址是否在一个网段，这决定了数据链层的目标MAC地址是目标计算机的还是路由器接口的MAC地址。数据包的目标IP地址决定了数据包最终到达哪一个计算机，而目标MAC地址决定了该数据包下一跳由哪个设备接收，不一定是终点。

### IP 地址
点分十进制记法
十六进制记法(注册表、编程使用)(0x810b0bef)

#### 分类编址
早期设计方案，存在缺陷,A、B、C类编址

分类    标志    第一字节范围    网络地址长度    最大网络数       互联网可分配网络数     最大主机数      地址空间数      地址空间数/IP总数
A       0       [1,126](0,127)  1B              2^7 - 2(0,127)    (2^7-2)-1             2^24-2          2^31         2^31/2^32 = 1/2
B       10      [128,191]       2B              2^14              (2^14)-16             2^16-2          2^30         2^30/2^32 = 1/4
C       110     [192,223]       3B              2^21              (2^21)-256            2^8-2           2^29         2^29/2^32 = 1/8
D       1110    [224,239]       多播地址(主要留给 英特网结构体系委员会IAB使用)
E       1111    [240,254]       保留为以后使用

主机位
    1. 全零：本主机所连接的单个网络地址/该网络的网络地址
    1. 全 1：广播地址

广播
    1. 直接广播（directed broadcasting）： 网络号.255
    1. 有限广播（limited broadcasting）: 255.255.255.255
        * 不需要知道网络号
        * 限制在本网络或本子网的范围内
        * 路由器会阻止有限广播

A
    0.      指本网络
    127.    本地回环测试,测试TCP/IP协议的正常与否,127.x.y.z
    10.0.0.0~10.255.255.255     私有地址,1个网络
B
    172.16.0.0~172.31.255.255    私有地址,16个网络
C
    192.168.0.0~192.168.255.255    私有地址, 256个网络

0.0.0.0  
    只能作为源地址
    最开始时候的ip地址，而使用255.255.255.255 作为目标地址,这样DHCP就可以给它分配ip
    用来指向默认路由
    **这个网络上的这个主机**

网络为全为0，主机地址为n, 表示**这个网络上的特定主机**
    0.0.0.64


单播，组播，广播

掩码

掩码
    网络位全为1，主机位全为零
    和ip地址做 与运算 得出网络地址
    CIDR记法(无类路由)：201.28.2.3/24

子网掩码
    从主机位借位
    比如借3位，就是2^3=8个子网(历史上要减2，现代不用-2，)

子网的主机范围
    1. 先算出子网号
    1. 算出广播地址
    1. [子网号+1，广播地址-1] 就是合法的主机范围了

子网数计算
    2^m
主机数计算
    (2^n)-2

超网
    将小的网络合并，例如将4个C类地址合并为一个

    x.y.32.z
    x.y.33.z
    x.y.34.z
    x.y.35.z
    
    x.y.0010 0000.0 32
    x.y.0010 0001.0 33
    x.y.0010 0010.0 34
    x.y.0010 0011.0 35
              !

    从网络位借位(从网络位减位)，"!"处，子网掩码变为22位

#### 无分类编址
1996年因特网管理机构选不了新的体系结构-无分类编址，使分类编制变为过时的技术

CIDR(无类别域间路由 classless inter-Domain routing)

掩码
/n      掩码            /n      掩码            /n      掩码            /n     掩码
/1       128.0.0.0      /9      255.128.0.0     /17     255.255.128     /25     255.255.255.128
/2       128.0.0.0      /10     255.128.0.0     /18     255.255.128     /26     255.255.255.128
...
**/8       128.0.0.0      /16     255.128.0.0     /24     255.255.128     /32     255.255.255.128**


可以看出，**分类编址是无分类编址的一个特例**
前缀：网络位
后缀：主机位

1000 0000   128
1100 0000   192
1110 0000   224
1111 0000   240
1111 1000   
1111 1100   
1111 1110   
1111 1111   

可变长度的子网（VLSM variable length subnet mask)


## 局域网
局域网有很多种
    1. 令牌环
    1. ARCnet
    1. 以太网
### IEEE 802局域网标准
罗伯特。梅特卡夫(以太网的发明，施乐Xerox)
    CSMA/CD
    成立 3com 公司
    1980年2月，IEEE下属的802局域网标准委员会成立，推出一系列语句网标准
    DIX 2.0(Ethernet II,DIX V2):Xerox 与 DEC、Intel 在1982年制定以太网标准


### 10Base以太网
### 快速以太网
### 交换式以太网
### 千兆以太网
### 其他种类的局域网
### 局域网中常用的技术


## TCP/IP
### 历史
1. Transmission Control Protocol/Internet Protocol的简写，中译名为传输控制协议/因特网互联协议
1. "阿帕"（ARPA），是美国高级研究计划署（Advanced Research Project Agency）的简称

1. 军用，中心节点，迂回线路，分组交换
    1. 分组交换：某个节点被破坏后并不影响整个网络的数据交换

1. 20世纪60年代，DoD 组织要求
1. 69年 arpanet诞生，开始分组交换技术
1. 75年，TCP/IP诞生
1. 1982年，TCP/IP规范出炉，Unix最早开始实现TCP/IP协议

## 无线网
国际标准 WiFi
中国标准 wapi


## 物理层的概念
单工：单向传播
    1. 收音机
    1. 电视
双工
    1. 全双工：同时双向传递
        1. 手机
    1. 半双工：轮流双向传输
        1. 对讲机
中继器：信号放大器
双绞线：100m
细缆：180m
粗缆：500m

### hub
1. 超级简单的设备
1. 半双工
1. 共享带宽
1. 广播
1. 不记忆MAC地址
1. 没有任何安全性的考虑
1. 物理层设备

## 以太
以太是古希腊哲学家亚里士多德所设想的一种物质。是物理学史上一种假想的物质观念，其内涵随物理学发展而演变。“以太”一词是英文Ether或Aether的音译。

19世纪的物理学家，认为它是一种曾被假想的电磁波的传播媒质，所以叫以太网

## 冲突域
在以太网中，如果某个CSMA/CD网络上的两台计算机在同时通信时会发生冲突，那么这个CSMA/CD网络就是一个冲突域（collision domain)。如果以太网中的各个网段以集线器连接，因为不能避免冲突，所以它们仍然是一个冲突域。

冲突域就是连接在同一导线上的所有工作站的集合，或者说是同一物理网段上所有节点的集合，或以太网上竞争同一带宽的节点集合.

## 广播域


## 以太网桥
混杂模式：即使目标地址不是自己，自己也会收下数据
两个口
学习源MAC地址(每个端口记录mac地址),第一次会进行转发，表中有了就可能不会转发了

可以隔离冲突域

## 三网
电信网
有线电视网
因特网


## 通信交换技术
### 电路交换(circuit switching)
典型的案例：专线电话
比特流直达终点
连接建立，数据(报文)传送，连接释放

连接建立需要花费很长时间

### 报文交换(message switching)
A → 报文 → B →  报文 → C
          **存储、转发**

报文 首部尾部会加信息

假设发生堵塞，可以将后来的数据存储，将先来的数据转发

如果报文过大，易堵塞；如果出错，整个报文要重新传送

没有在通信两端设备间建立一条物理线路

报文优先级

交换设备可以复制报文，广播

A 10mbps      交换机          B 100mbps
A -> B ok
B -> A 交换机的存储 做缓冲区

可以进行码型的转换，如 ASCII  转换为 IBM 开发的 EBCDIC 码

### 分组交换(packet switching 报文分组交换，包交换)
1. 数据报(data gram)
    1. 分组，每个组可以选择不同的线路，最后分组重组报文
    1. 多用于局域网
1. 虚电路(virtual circuit)
    1. 建立专用线路, 分组不打散？到达顺序？
    1. 两种古老的这种技术
        1. x.25
        1. 帧中继


将一个报文分成多个组来进行传输，每个组都有目标、源地址
也是一种存储转发
每一段报文加上地址、控制和差错校验等信息 

## 传输介质
### 有线传输
#### 双绞线(TP: twisted Pair wire)
非屏蔽双绞线(UTP)
  屏蔽双绞线(STP)

白色丝线:可以用来撕开皮

绞距:较短的比较好

铝箔

有的还有接地导线：处理静电

聚氯乙烯外皮

电气性能分类
1. 1,2,3,4类
1. 5,超5,6，超6,7类

3类：传输频率16MHz 最高传输速率10Mbps
5类：传输频率100MHz 最高传输速率100Mbps
    CAT 5
超5类：传输频率155MHz 最高传输速率100Mbps
    CAT 5E

6类：传输频率250MHz 最高传输速率1000Mbps
超6类：传输频率255MHz 最高传输速率1000Mbps,十字架

7类：传输频率600MHz 最高传输速率10Gbps

回波信号干扰

#### 同轴电缆(BNC)
有线电视
监控

铜线 绝缘层 屏蔽膜 屏蔽线网 外层

监控线一般还包含电源线

粗缆 75-5
细缆 75-3

#### 光纤(optical fiber)
单模
    传输信息不依靠全反射
    光纤直径一般8.3微米
    50-100km
    S
多模
    传输信息依靠全反射
    直径大于10 一般是多模
    传输距离短，2-4km
    外皮的颜色一般是是黄色
    M


### 无线传输介质
1. 无线电波
    1. 直线传播
    1. 反射传播:电离层
1. 卫星(微波)
1. 红外线










